| *Comment* | Test Case: Workspace Privacy |  |

| *Comment* | Test Case: Workspace Privacy. Make a scratch workspace |  |
| set | wspriv | wspriv-%%start_time%% |
| set | perm_link | /%%wspriv%%/?action=workspaces_permissions |

| st-admin | create-workspace --empty --n %%wspriv%% --t WSPRIV | was created |
| st-admin | add-workspace-admin --u %%username%% --w %%wspriv%% | now has the role of 'admin' |
| st-create-wikipage | %%wspriv%% | WSPRIV |
| st-admin | set-permissions --p public --w %%wspriv%% | have been changed |

| *Comment* | Test Case: Workspace Privacy. enable self-join server wide |  |
| st-config | set self_registration 1 |  |
| st-config | set allow_network_invitation 1 |  |
| st-appliance-config | set captcha_enabled 0 | Set captcha_enabled to 'UNDEF' |

| *Comment* | Test Case: Workspace Privacy Public Workspace Save is still public |  |
| open_ok | /%%wspriv%%/?action=users_settings |  |
| clickAndWait | link=Workspace Privacy |  |
| text_like | //body | Do you want to set up this workspace as: |
| wait_for_element_visible_ok | //input[@name='permission_set_name' and @value='member-only'] | 30000 |
| wait_for_element_visible_ok | //input[@name='permission_set_name' and @value='not-member-only'] | 30000 |
| clickAndWait | link=Save |  |
| clickAndWait | link=Log out |  |

| *Comment* | Test Case: Workspace Privacy verify public |  |
| wait_for_element_present_ok | st-edit-button-link | 5000 |
| wait_for_element_present_ok | st-comment-button-link | 5000 |
| wait_for_element_present_ok | st-edit-button-link-bottom | 5000 |
| wait_for_element_present_ok | st-comment-button-link-bottom | 5000 |

| *Comment* | Test Case: Workspace Privacy Public Read Only Workspace Save Maintains Settings |  |
| st-admin | set-permissions --p public-read-only --w %%wspriv%% | have been changed |
| st-login |  |  |
| open_ok | %%perm_link%% |  |
| text_like | //body | Do you want to set up this workspace as: |
| wait_for_element_visible_ok | //input[@name='permission_set_name' and @value='member-only'] | 30000 |
| wait_for_element_visible_ok | //input[@name='permission_set_name' and @value='not-member-only'] | 30000 |
| clickAndWait | link=Save |  |
| clickAndWait | link=Log out |  |

| *Comment* | Test Case: Workspace Privacy verify public read only |  |
| wait_for_element_not_present_ok | st-edit-button-link | 5000 |
| wait_for_element_not_present_ok | st-comment-button-link | 5000 |
| wait_for_element_not_present_ok | st-edit-button-link-bottom | 5000 |
| wait_for_element_not_present_ok | st-comment-button-link-bottom | 5000 |

| *Comment* | Test Case: Workspace Privacy Public Comment Only Workspace Save Maintains Settings |  |
| st-admin | set-permissions --p public-comment-only --w %%wspriv%% | have been changed |
| st-login |  |  |
| open_ok | %%perm_link%% |  |
| text_like | //body | Do you want to set up this workspace as: |
| wait_for_element_visible_ok | //input[@name='permission_set_name' and @value='member-only'] | 30000 |
| wait_for_element_visible_ok | //input[@name='permission_set_name' and @value='not-member-only'] | 30000 |

| *Comment* | Ensure type of public-ness permissions are preserved on save event |
| clickAndWait | link=Save |  |
| clickAndWait | link=Log out |  |
| wait_for_element_not_present_ok | st-edit-button-link | 5000 |
| wait_for_element_present_ok | st-comment-button-link | 5000 |
| wait_for_element_not_present_ok | st-edit-button-link-bottom | 5000 |
| wait_for_element_present_ok | st-comment-button-link-bottom | 5000 |

| *Comment* | Test Case: Workspace Privacy Public Join-To-Edit Save Maintains Settings |  |
| st-admin | set-permissions --p public-join-to-edit --w %%wspriv%% | have been changed |
| st-login |  |  |
| open_ok | %%perm_link%% |  |
| text_like | //body | Do you want to set up this workspace as: |
| wait_for_element_visible_ok | //input[@name='permission_set_name' and @value='member-only'] | 30000 |
| wait_for_element_visible_ok | //input[@name='permission_set_name' and @value='not-member-only'] | 30000 |

| *Comment* | Ensure type of public-ness permissions are preserved on save event |
| clickAndWait | link=Save |  |
| clickAndWait | link=Log out |  |
| wait_for_element_visible_ok | link=Join to edit | 30000 |

| *Comment* | Test Case: Workspace Privacy Join |  |
| clickAndWait | link=Join to edit |  |
| wait_for_element_visible_ok | email_address | 30000 |
| wait_for_element_visible_ok | register_password | 30000 |
| wait_for_element_visible_ok | register_password2 | 30000 |
| wait_for_element_visible_ok | last_name | 30000 |
| wait_for_element_visible_ok | first_name | 30000 |

| *Comment* | Test Case: Workspace Privacy Intranet Values are correct |  |
| st-admin | set-permissions --p intranet --w %%wspriv%% | have been changed |
| st-login |  |  |
| open_ok | %%perm_link%% |  |
| text_like | //body | Do you want to set up this workspace as: |
| wait_for_element_visible_ok | //input[@name='permission_set_name' and @value='member-only'] | 30000 |
| wait_for_element_visible_ok | //input[@name='permission_set_name' and @value='not-member-only'] | 30000 |

| *Comment* | Test Case: Workspace Privacy Authed user values are correct |  |
| st-admin | set-permissions --p authenticated-user-only --w %%wspriv%% | have been changed |
| open_ok | %%perm_link%% |  |
| text_like | //body | Do you want to set up this workspace as: |
| wait_for_element_visible_ok | //input[@name='permission_set_name' and @value='member-only'] | 30000 |
| wait_for_element_visible_ok | //input[@name='permission_set_name' and @value='not-member-only'] | 30000 |

| *Comment* | Test Case: Workspace Privacy set to member only, see change |
| click_ok | //input[@name='permission_set_name' and @value='member-only'] |  |
| clickAndWait | link=Save |  |
| text_like | //body | Workspaces are private by default. All users need to log in to view pages. Only workspace admins can invite new users |
| text_like | //body | If you need public workspaces that can be viewed by users without logging in, please contact Socialtext Support. |
| wait_for_element_not_present_ok | //input[@name='permission_set_name' and @value='member-only'] | 30000 |
| wait_for_element_not_present_ok | //input[@name='permission_set_name' and @value='not-member-only'] | 30000 |
| clickAndWait | link=Log out |
| *Comment* | Test Case: Workspace Privacy verify private |  |
| wait_for_element_visible_ok | username | 5000 |
| wait_for_element_visible_ok | password | 5000 |
| text_like | Log in to Socialtext |  |
| text_like | Password: |  |

| *Comment* | Test Case: Workspace Privacy email from guest/authenticated user |  |
| st-login |  |  |
| open_ok | /%%wspriv%%/ |  |
| clickAndWait | link=Settings |  |
| clickAndWait | link=Workspace Privacy |  |
| click_ok | //input[@name='guest_has_email_in' and @value='1'] |  |
| clickAndWait | link=Save |  |
| text_like | contentContainer | Anyone can send email to %%wspriv%%. |
| click_ok | //input[@name='guest_has_email_in' and @value='0'] |  |
| clickAndWait | link=Save |  |
| text_like | contentContainer | Only registered users can send email to %%wspriv%%. |

| *Comment* | Test Case: Workspace Privacy TEARDOWN |  |
| st-process-jobs | PageIndex | %%wspriv%% |
| st-admin | delete-workspace --no-export --workspace %%wspriv%% | has been deleted |

| *Comment* | Test Case: Workspace Privacy COMPLETED |  |
