
| *Comment* | Test Case: Widgets in Profile |  |



* Fixture: SocialWidgets

| set | wip_user | wip_user_%%start_time%%@david.socialtext.net |
| create_user | %%wip_user%% | %%password%% |
| st-logoutin | %%wip_user%% | %%password%% |

| *Comment* | Test Case: Widgets in Profile verify layout, click Cancel |  |
| open_ok | /st/profile |  |
| wait_for_element_visible_ok | st-edit-layout | 30000 |
| click_ok | st-edit-layout |  |
| wait_for_text_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |
| wait_for_element_visible_ok | st-revert-layout | 30000 |
| wait_for_element_visible_ok | st-cancel-layout | 30000 |
| wait_for_element_visible_ok | st-save-layout | 30000 |
| wait_for_element_visible_ok | st-add-widget | 30000 |
| click_and_wait | st-cancel-layout | 30000 |
| text_unlike | contentContainer | You are in layout mode. Click Save to keep your changes, Cancel to discard them. |

| *Comment* | Test Case: Widgets in Profile add widget then cancel, widget is gone |  |
| wait_for_element_visible_ok | st-edit-layout | 30000 |
| click_ok | st-edit-layout |  |
| wait_for_text_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |
| wait_for_element_visible_ok | st-add-widget | 30000 |
| click_ok | st-add-widget |  |
| wait_for_element_visible_ok | //a[@id='gallery-widget-Wikipedia'] | 30000 |
| click_ok | st-widget-opensocial-gallery-cancel |  |
| wait_for_element_not_present_ok | //a[@id='gallery-widget-Wikipedia'] | 30000 |
| click_ok | st-add-widget |  |
| wait_for_element_visible_ok | //a[@id='gallery-widget-Wikipedia'] | 30000 |
| click_ok | //a[@id='gallery-widget-Wikipedia'] |  |
| wait_for_element_not_present_ok | //a[@id='gallery-widget-Wikipedia'] | 3000 |
| wait_for_text_present_ok | Wikipedia | 30000 |
| click_and_wait | st-cancel-layout |  |
| text_unlike | contentContainer | You are in layout mode. Click Save to keep your changes, Cancel to discard them. |
| open_ok | /st/profile |  |
| text_unlike | contentContainer | Wikipedia |

| *Comment* | Test Case: Widgets in Profile add widget, is there |  |
| wait_for_element_visible_ok | st-edit-layout | 10000 |
| click_ok | st-edit-layout |  |
| wait_for_text_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |
|  *Comment* |  Test sometimes adds a second widget or fails to change prefs. Slow it down ? |  |
|  set_speed_ok | 2000  |  |
| wait_for_element_visible_ok | st-add-widget | 10000 |
| click_ok | st-add-widget |  |
| wait_for_element_visible_ok | //a[@id='gallery-widget-Wikipedia'] | 30000 |
| click_ok | //a[@id='gallery-widget-Wikipedia'] |  |
| wait_for_element_not_present_ok | //a[@id='gallery-widget-Wikipedia'] | 10000 |
| wait_for_text_present_ok | Wikipedia | 30000 |
| text_like | `xpath=(//div[@class='widgetHeaderTitle'])[4]` | Wikipedia |
| text_like | `xpath=(//div[@class='widgetHeaderTitle'])[5]` | Colleagues |
| click_ok | st-save-layout |  |
| wait_for_text_not_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |
| wait_for_element_visible_ok | st-edit-group | 30000 |
| wait_for_element_visible_ok | st-edit-layout | 30000 |
| wait_for_text_present_ok | Wikipedia | 30000 |
| text_like | `xpath=(//div[@class='widgetHeaderTitle'])[4]` | Wikipedia |
| text_like | `xpath=(//div[@class='widgetHeaderTitle'])[5]` | Colleagues |
| text_unlike | contentContainer | You are in layout mode. Click Save to keep your changes, Cancel to discard them. |

| *Comment* | Test Case: Widgets in Profile change widget preferences |  |
| click_ok | st-edit-layout |  |
| wait_for_text_present_ok | You are in layout mode | 30000 |
| wait_for_element_visible_ok | `xpath=(//a[@class='settings'])[4]` | 30000 |
| click_ok | `xpath=(//a[@class='settings'])[4]` |  |
| wait_for_text_present_ok | Language: | 30000 |
| wait_for_element_visible_ok | //select[@name='lang'] | 30000 |
| select_ok | //select[@name='lang'] | label=French |
| is_selected_ok | //select[@name='lang'] | label=French |
| wait_for_element_visible_ok | `xpath=(//input[@type='submit' and @value="Save"])[4]` | 30000 |
| click_ok | `xpath=(//input[@type='submit' and @value="Save"])[4]` |  |
| wait_for_element_not_visible_ok | `xpath=(//input[@type='submit' and @value="Save"])[4]` | 30000 |
| wait_for_element_visible_ok | st-save-layout |  |
| click_ok | st-save-layout |  |
| wait_for_element_visible_ok | st-edit-group | 30000 |
| wait_for_element_visible_ok | st-edit-layout | 30000 |

| *Comment* | Test Case: Widgets in Profile verify changed preferences |  |
| *Comment* | Must reopen profile to refresh widget IDs for Selenium |  |
| open_ok | /st/profile |  |
| wait_for_element_visible_ok | st-edit-layout | 30000 |

| *Comment* | Test Case: Widgets in Profile wait for iframe headers |  |
| wait_for_text_present_ok | Wikipedia | 10000 |
| wait_for_text_present_ok | Colleagues | 10000 |
| st-name-widget | 4 | wiki |
| st-widget-title-like | wiki | Wikipedia |
| st-select-widget-frame | wiki |  |
| wait_for_text_present_ok | Wiki Search (French) | 10000 |
| select-frame | relative=parent |  |
|  set_speed_ok | 0  |  |

| *Comment* | Test Case: Widgets in Profile use X button to remove widget |  |
| click_ok | st-edit-layout |  |
| wait_for_text_present_ok | You are in layout mode | 30000 |
| wait_for_element_visible_ok | `xpath=(//a[@class='close'])[3]` | 30000 |
| click_ok | `xpath=(//a[@class='close'])[3]` |  |
| wait_for_text_not_present_ok | Wikipedia | 30000 |
| click_ok | st-save-layout |  |
| wait_for_element_visible_ok | st-edit-group | 30000 |
| wait_for_element_visible_ok | st-edit-layout | 30000 |
| wait_for_text_not_present_ok | Wikipedia | 30000 |
| text_like | `xpath=(//div[@class='widgetHeaderTitle'])[4]` | Colleagues |

| *Comment* | Test Case: Widgets in Profile add widget back |  |
| wait_for_element_visible_ok | st-edit-layout | 10000 |
| click_ok | st-edit-layout |  |
| wait_for_text_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |
| wait_for_element_visible_ok | st-add-widget | 10000 |
| click_ok | st-add-widget |  |
| wait_for_element_visible_ok | //a[@id='gallery-widget-Wikipedia'] | 30000 |
| click_ok | //a[@id='gallery-widget-Wikipedia'] |  |
| wait_for_element_not_present_ok | //a[@id='gallery-widget-Wikipedia'] | 10000 |
| wait_for_text_present_ok | Wikipedia | 30000 |
| text_like | `xpath=(//div[@class='widgetHeaderTitle'])[4]` | Wikipedia |
| text_like | `xpath=(//div[@class='widgetHeaderTitle'])[5]` | Colleagues |
| click_ok | st-save-layout |  |
| wait_for_text_not_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |
| wait_for_element_visible_ok | st-edit-group | 30000 |
| wait_for_element_visible_ok | st-edit-layout | 30000 |
| wait_for_text_present_ok | Wikipedia | 30000 |
| text_like | `xpath=(//div[@class='widgetHeaderTitle'])[4]` | Wikipedia |
| text_like | `xpath=(//div[@class='widgetHeaderTitle'])[5]` | Colleagues |
| text_unlike | contentContainer | You are in layout mode. Click Save to keep your changes, Cancel to discard them. |

| *Comment* | Test Case: Widgets in Profile start to revert to default, click no |  |
| click_ok | st-edit-layout |  |
| wait_for_text_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |
| wait_for_element_visible_ok | st-revert-layout | 30000 |
| click_ok | st-revert-layout |  |
| wait_for_text_present_ok | Are you sure you want to revert to the Socialtext defaults? | 30000 |
| wait_for_element_visible_ok | dashboard-revert-yes | 30000 |
| wait_for_element_visible_ok | dashboard-revert-no | 30000 |
| pause | 2000 |  |
| click_ok | dashboard-revert-no |  |
| wait_for_element_not_present_ok | dashboard-revert-yes | 30000 |
| wait_for_element_not_present_ok | dashboard-revert-no | 30000 |
| wait_for_text_present_ok | Wikipedia | 30000 |
| click_ok | st-save-layout |  |
| wait_for_text_not_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |
| wait_for_text_present_ok | Wikipedia | 30000 |
| text_like | `xpath=(//div[@class='widgetHeaderTitle'])[4]` | Wikipedia |
| text_like | `xpath=(//div[@class='widgetHeaderTitle'])[5]` | Colleagues |
| wait_for_element_visible_ok | st-edit-group | 30000 |
| wait_for_element_visible_ok | st-edit-layout | 30000 |
| text_unlike | contentContainer | You are in layout mode. Click Save to keep your changes, Cancel to discard them. |

| *Comment* | Test Case: Widgets in Profile revert to default |  |
| click_ok | st-edit-layout |  |
| wait_for_text_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |
| wait_for_element_visible_ok | st-revert-layout | 30000 |
| click_ok | st-revert-layout |  |
| wait_for_text_present_ok | Are you sure you want to revert to the Socialtext defaults? | 30000 |
| wait_for_element_visible_ok | dashboard-revert-yes | 30000 |
| wait_for_element_visible_ok | dashboard-revert-no | 30000 |
| pause | 2000 |  |
| click_ok | dashboard-revert-yes |  |
| wait_for_element_not_present_ok | dashboard-revert-yes | 30000 |
| wait_for_element_not_present_ok | dashboard-revert-no | 30000 |
| wait_for_text_not_present_ok | Wikipedia | 30000 |
| click_ok | st-save-layout |  |
| wait_for_text_not_present_ok | You are in layout mode. Click Save to keep your changes, Cancel to discard them. | 30000 |
| wait_for_text_not_present_ok | Wikipedia | 30000 |
| wait_for_text_present_ok | Tags | 30000 |
| wait_for_text_present_ok | Activities | 30000 |
| text_like | `xpath=(//div[@class='widgetHeaderTitle'])[2]` | Tags |
| text_like | `xpath=(//div[@class='widgetHeaderTitle'])[4]` | Colleagues |

| *Comment* | Test Case: Widgets in Profile TEARDOWN |  |
| st-admin | deactivate-user --email %%wip_user%% | been removed |

| *Comment* | Test Case: Widgets in Profile COMPLETED |  |
