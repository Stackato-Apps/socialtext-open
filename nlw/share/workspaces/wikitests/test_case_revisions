| *Comment* | START Test Case: Revisions |  |

| *Comment* | Test Case: Revisions: Create a page with five revisions |  |

| open_ok | /%%workspace%%/?action=new_page |  |
| wait_for_element_visible_ok | link=Wiki Text | 30000 |
| click_ok | link=Wiki Text |  |
| wait_for_element_visible_ok | st-newpage-pagename-edit | 30000 |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 30000 |
| type_ok | st-newpage-pagename-edit | test case revisions %%start_time%% |
| type_ok | wikiwyg_wikitext_textarea | original revision number one %%start_time%% |
| wait_for_element_visible_ok | st-save-button-link | 30000 |
| st-page-save |  |  |
| click_ok | st-edit-button-link |  |
| wait_for_element_visible_ok | link=Wiki Text | 30000 |
| click_ok | link=Wiki Text |  |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 30000 |
| type_ok | wikiwyg_wikitext_textarea | revision number two %%start_time%% |
| wait_for_element_visible_ok | st-save-button-link | 30000 |
| st-page-save |  |  |
| click_ok | st-edit-button-link |  |
| wait_for_element_visible_ok | link=Wiki Text | 30000 |
| click_ok | link=Wiki Text |  |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 30000 |
| type_ok | wikiwyg_wikitext_textarea | revision number three %%start_time%% |
| wait_for_element_visible_ok | st-save-button-link | 30000 |
| st-page-save |  |  |
| click_ok | st-edit-button-link |  |
| wait_for_element_visible_ok | link=Wiki Text | 30000 |
| click_ok | link=Wiki Text |  |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 30000 |
| type_ok | wikiwyg_wikitext_textarea | `[revision number four] %%start_time%%` |
| wait_for_element_visible_ok | st-save-button-link | 30000 |
| st-page-save |  |  |
| click_ok | st-edit-button-link |  |
| wait_for_element_visible_ok | link=Wiki Text | 30000 |
| click_ok | link=Wiki Text |  |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 30000 |
| type_ok | wikiwyg_wikitext_textarea | `[revision number five] %%start_time%%` |
| wait_for_element_visible_ok | st-save-button-link | 30000 |
| st-page-save |  |  |

| *Comment* | Test Case: Revisions: Check for sorting and the "Compare Revisions" button |  |
| wait_for_element_visible_ok | //a[contains(@href,'action=revision_list')] | 30000 |
| clickAndWait | `//a[contains(@href,'action=revision_list')]` |  |
| wait_for_element_visible_ok | link=Back To Current Revision | 30000 |
| clickAndWait | link=Back To Current Revision |  |
| wait_for_text_present_ok | revision number five | 30000 |
| wait_for_element_visible_ok | //a[contains(@href,'action=revision_list')] | 30000 |
| clickAndWait | `//a[contains(@href,'action=revision_list')]` |  |


| *Comment* | Test Case: Revisions: Prev/Next Button on revisions view |  |
| wait_for_element_visible_ok | link=Revision 2 | 30000 |
| clickAndWait | link=Revision 2 |  |
| wait_for_element_visible_ok | link=Next Revision |
| clickAndWait | link=Next Revision |
| wait_for_text_present_ok | Revision 3 | 30000 |
| wait_for_element_visible_ok | link=Next Revision |
| clickAndWait | link=Next Revision |
| wait_for_text_present_ok | Revision 4 | 30000 |
| wait_for_element_visible_ok | link=Next Revision |
| clickAndWait | link=Next Revision |
| wait_for_text_present_ok | Revision 5 | 30000 |
| wait_for_element_visible_ok | link=Next Revision |
| clickAndWait | link=Next Revision |
| wait_for_text_present_ok | Revision 5 | 30000 |
| wait_for_element_visible_ok | link=Previous Revision |
| clickAndWait | link=Previous Revision |
| wait_for_text_present_ok | Revision 4 | 30000 |
| wait_for_element_visible_ok | link=Previous Revision |
| clickAndWait | link=Previous Revision |
| wait_for_text_present_ok | Revision 3 | 30000 |
| wait_for_element_visible_ok | link=Previous Revision |
| clickAndWait | link=Previous Revision |
| wait_for_text_present_ok | Revision 2 | 30000 |
| wait_for_element_visible_ok | link=Previous Revision |
| clickAndWait | link=Previous Revision |
| wait_for_text_present_ok | Revision 1 | 30000 |
| wait_for_element_visible_ok | link=Previous Revision |
| clickAndWait | link=Previous Revision |
| wait_for_text_present_ok | Revision 1 | 30000 |


| *Comment* | Test Case: Revisions: Check for sorting and the "Compare Revisions" button |  |
| open_ok | /%%workspace%%/?test case revisions %%start_time%% |
| wait_for_element_visible_ok | //a[contains(@href,'action=revision_list')] | 30000 |
| clickAndWait | `//a[contains(@href,'action=revision_list')]` |  |
| text_like | qr/Revision 5.+Revision 4.+Revision 3.+Revision 2.+Revision 1/ |  |
| wait_for_element_visible_ok | link=Compare Revisions | 30000 |
| text_like | bottomButtons | Compare Revisions |

| *Comment* | Test Case: Revisions: Check the correct radio buttons are set |  |
| verifyValue | new_revision_id | on |
| verifyValue | document.revisions.old_revision_id[1] | on |
| clickAndWait | link=Back To Current Revision |  |
| text_like | revision number five |  |
| wait_for_element_visible_ok | //a[contains(@href,'action=revision_list')] | 30000 |
| clickAndWait | `//a[contains(@href,'action=revision_list')]` |  |

| *Comment* | Test Case: Revisions: Check again for sorting and the "Compare Revisions" button |  |
| text_like | qr/Revision 5.+Revision 4.+Revision 3.+Revision 2.+Revision 1/ |  |
| *Comment* | Test Case: Revisions: Check again the correct radio buttons are set |  |
| verifyValue | new_revision_id | on |
| verifyValue | document.revisions.old_revision_id[1] | on |

| *Comment* | Test Case: Revisions: Comparing revisions |  |
| clickAndWait | link=Compare Revisions |  |
| text_like | qr/Revision 4.+Revision 5.+four.+five/s |  |

| *Comment* | Test Case: Revisions: test bottom button |  |
| clickAndWait | link=All Revisions |  |
| clickAndWait | //a[@class='compareRevisions genericBlueButton'][1] |  |
| text_like | qr/Revision 4.+Revision 5.+four.+five/s |  |
| clickAndWait | link=All Revisions |  |
| click_ok | document.revisions.old_revision_id[4] |  |
| click_ok | document.revisions.new_revision_id[1] |  |

| *Comment* | Test Case: Revisions: test Next compare button |  |
| clickAndWait | link=Compare Revisions |  |
| text_like | qr/Revision 1.+Revision 4.+one.+four/s |  |
| wait_for_element_visible_ok | link=Next Compare | 30000 |
| clickAndWait | link=Next Compare | 30000 |
| text_like | qr/Revision 2.+Revision 4.+two.+four/s |  |
| wait_for_element_visible_ok | link=Next Compare | 30000 |
| clickAndWait | link=Next Compare | 30000 |
| text_like | qr/Revision 3.+Revision 4.+three.+four/s |  |
| wait_for_element_visible_ok | link=Next Compare | 30000 |
| clickAndWait | link=Next Compare | 30000 |
| text_like | qr/Revision 4.+Revision 4.+four.+four/s |  |
| wait_for_element_visible_ok | link=Next Compare | 30000 |
| clickAndWait | link=Next Compare | 30000 |
| text_like | qr/Revision 5.+Revision 4.+five.+four/s |  |
| wait_for_element_visible_ok | link=Next Compare | 30000 |
| clickAndWait | link=Next Compare | 30000 |
| text_like | qr/Revision 5.+Revision 4.+five.+four/s |  |

| *Comment* | Test Case: Revisions: test Previous compare button |  |
| wait_for_element_visible_ok | link=Previous Compare | 30000 |
| clickAndWait | link=Previous Compare |  |
| text_like | qr/Revision 4.+Revision 4.+four.+four/s |  |
| wait_for_element_visible_ok | link=Previous Compare | 30000 |
| clickAndWait | link=Previous Compare |  |
| text_like | qr/Revision 3.+Revision 4.+three.+four/s |  |
| wait_for_element_visible_ok | link=Previous Compare | 30000 |
| clickAndWait | link=Previous Compare |  |
| text_like | qr/Revision 2.+Revision 4.+two.+four/s |  |
| wait_for_element_visible_ok | link=Previous Compare | 30000 |
| clickAndWait | link=Previous Compare |  |
| wait_for_element_visible_ok | link=Previous Compare | 30000 |
| clickAndWait | link=Previous Compare |  |
| text_like | qr/Revision 1.+Revision 4.+one.+four/s |  |

| *Comment* | Test Case: Revisions: Comparing revision to itself |  |
| clickAndWait | link=All Revisions |  |
| wait_for_element_visible_ok | //a[@class='compareRevisions genericBlueButton'] | 30000 |
| click_ok | document.revisions.old_revision_id[2] |  |
| click_ok | document.revisions.new_revision_id[2] |  |
| click_ok | //a[@class='compareRevisions genericBlueButton'] |  |

| *Comment* | Test Case: Revisions. cannot compare revision to itself |  |
| verifyAlert | You cannot compare a revision to itself. |  |

| *Comment* | Test Case: Revisions: older vs. younger |  |
| clickAndWait | link=Back To Current Revision |  |
| text_like | revision number five |  |
| wait_for_element_visible_ok | //a[contains(@href,'action=revision_list')] | 30000 |
| clickAndWait | `//a[contains(@href,'action=revision_list')]` |  |
| clickAndWait | link=Compare Revisions |  |
| text_like | qr/Revision 4.+Revision 5.+four.+five/s |  |

| *Comment* | Test Case: Revisions: younger vs. older |  |
| clickAndWait | link=All Revisions |  |
| click_ok | old_revision_id |  |
| click_ok | document.revisions.new_revision_id[1] |  |
| clickAndWait | link=Compare Revisions |  |
| text_like | qr/Revision 5.+Revision 4.+five.+four/s |  |

| *Comment* | Test Case: Revisions: Checking revision formatting views |  |
| clickAndWait | link=Back To Current Revision |  |
| wait_for_element_visible_ok | //a[contains(@href,'action=revision_list')] | 30000 |
| clickAndWait | `//a[contains(@href,'action=revision_list')]` |  |
| clickAndWait | link=Compare Revisions |  |

| text_like | st-revision-display | four |
| text_like | st-revision-display | five |
| text_like | `[revision number five] %%start_time%%` |  |

| clickAndWait | link=View Formatted |  |
| text_unlike | st-revision-display | `[revision number five] %%start_time%%` |
| text_like | st-revision-display | `revision number five %%start_time%%` |

| clickAndWait | link=Color View (Unformatted) |  |
| text_like | st-revision-display | four |
| text_like | st-revision-display | five |

| clickAndWait | link=Revision 4 |  |
| text_like | Revision 4 |  |
| text_like | revision number four |  |

| clickAndWait | link=All Revisions |  |
| clickAndWait | link=Compare Revisions |  |
| clickAndWait | link=Revision 5 |  |
| text_like | Revision 5 |  |
| text_like | revision number five |  |

Find the same page using search, What's New list, and Revisions link. Observe revision count. | Count should be correct and identical in all three results

| *Comment* | Test Case: Revisions: Checking revisions are correct when arriving at page from different paths |  |
| st-admin | index-page --w %%workspace%% --page test_case_revisions_%%start_time%% |  |
| type_ok | st-search-term | revision |
| clickAndWait | st-search-submit |  |
| wait_for_element_visible_ok | link=test case revisions %%start_time%% | 30000 |
| clickAndWait | link=test case revisions %%start_time%% |  |
| text_like | `//a[contains(@href,'action=revision_list')]` | qr/5.+Revisions/ |

| open_ok | /%%workspace%%/?action=recent_changes |  |
| wait_for_element_visible_ok | link=test case revisions %%start_time%% | 30000 |
| clickAndWait | link=test case revisions %%start_time%% |  |
| text_like | `//a[contains(@href,'action=revision_list')]` | qr/5.+Revisions/ |

from All Revisions, click an older version | older version appears
from Compare Revisions, click the link above the older version | older version appears

| wait_for_element_visible_ok | //a[contains(@href,'action=revision_list')] | 30000 |
| clickAndWait | `//a[contains(@href,'action=revision_list')]` |  |
| wait_for_element_visible_ok | link=Revision 2 | 30000 |
| clickAndWait | link=Revision 2 |  |
| text_like | revision number two %%start_time%% |  |
| clickAndWait | link=All Revisions |  |
| click_ok | document.revisions.old_revision_id[3] |  |
| clickAndWait | link=Compare Revisions |  |
| clickAndWait | //strong |  |
| text_like | revision number two %%start_time%% |  |
| clickAndWait | link=All Revisions |  |

| *Comment* | Test Case: Revisions: Restoring revision |  |
| wait_for_element_visible_ok | link=Revision 2 | 30000 |
| clickAndWait | link=Revision 2 |  |
| text_like | link=Source View | Source View |
| clickAndWait | link=Source View |  |
| text_like | link=Normal View | Normal View |
| clickAndWait | st-revision-restorebutton |  |

| *Comment* | Test Case: Revisions: use the revisions/views link at the bottom of the page |  |
| wait_for_element_visible_ok | link=6 revisions | 30000 |
| clickAndWait | link=6 revisions |  |
| text_like | qr/Revision 2.+Revision 5.+Revision 4.+Revision 3.+Revision 2.+Revision 1/s |  |
| clickAndWait | link=Back To Current Revision |  |
| text_like | revision number two |  |

| *Comment* | Test Case: Revisions: make a revision with an edit summary |  |
| open_ok | /%%workspace%%/?test case revisions %%start_time%% |  |
| wait_for_element_visible_ok | st-edit-button-link | 30000 |
| click_ok | st-edit-button-link |  |
| wait_for_element_visible_ok | link=Wiki Text | 30000 |
| click_ok | link=Wiki Text |  |
| wait_for_element_visible_ok | wikiwyg_wikitext_textarea | 30000 |
| type_ok | wikiwyg_wikitext_textarea | Revision 7 containing an edit summary |
| wait_for_element_visible_ok | st-edit-summary-text-area | 30000 |
| type_ok | st-edit-summary-text-area | Edit Summary %%start_time%% |
| wait_for_element_visible_ok | st-save-button-link | 30000 |
| st-page-save |  |

| *Comment* | Test Case: Revisions: Check for edit summary in revision compare |  |
| wait_for_element_visible_ok | //a[contains(@href,'action=revision_list')] | 30000 |
| clickAndWait | //a[contains(@href,'action=revision_list')] |  |
| wait_for_text_present_ok | test case revisions %%start_time%% | 30000 |
| text_like | qr/Revision 3.+Revision 2/s |  |
| wait_for_element_visible_ok | link=Compare Revisions | 30000 |
| clickAndWait | link=Compare Revisions |  |
| wait_for_text_present_ok | test case revisions %%start_time%% | 30000 |
| text_like | qr/revision 2.+by.+on/ims |  |
| text_like | qr/revision 3.+by.+on.+saying.+Edit Summary %%start_time%%/ims |  |

| *Comment* | Test Case: Revisions: Check for edit summary in revision itself |  |
| clickAndWait | link=Revision 3 |  |
| text_like | Edit Summary %%start_time%% |  |

| *Comment* | Test Case: Revisions: TEARDOWN |  |
| st-process-jobs | PageIndex | %%workspace%% |
| st-admin | purge-page --w %%workspace%% --page test_case_revisions_%%start_time%% | was purged |

| *Comment* | Test Case: Revisions COMPLETED |  |
