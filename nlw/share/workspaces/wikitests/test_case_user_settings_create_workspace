| *Comment* | Test Case: User Settings Create Workspace |

| *Comment* | Test Case: User Settings Create Workspace SETUP Create Account, User, Workspace |  |
| set | acct | user-setting-acct-%%start_time%% |
| set | ws | user-setting-ws-%%start_time%% |
| set | user | user-setting%%start_time%%@matt.socialtext.net |
| st-admin | create-account --name %%acct%% | was created |
| st-admin | create-workspace --empty --name %%ws%% --title %%ws%% --account %%acct%% | was created |
| st-admin | create-user --e %%user%% --p %%password%% --account %%acct%% | was created |
| st-admin | add-member --e %%user%% --w %%ws%% | now has the role of 'member' in the |

| *Comment* | Test Case: User Settings Create Workspace Login as user, do *not* see workspace link |  |
| st-logoutin | %%user%% | %%password%% |
| open_ok | /%%ws%%/ |  |
| wait_for_element_visible_ok | link=Settings | 30000 |
| click_and_wait | link=Settings |  |
| wait_for_element_not_present_ok | link=Create New Workspace | 30000 |

| *Comment* | Test Case: User Settings Create Workspace Promote to workspace admin, *do* see Create New Workspace link |  |
| st-admin | add-workspace-admin --e %%user%% --w %%ws%% | now has the role of 'admin' |
| open_ok | / |  |
| open_ok | /%%ws%%/ |  |
| wait_for_element_visible_ok | link=Settings | 30000 |
| click_and_wait | link=Settings |  |
| wait_for_element_visible_ok | link=Create New Workspace | 30000 |

| *Comment* | Test Case: User Settings Create Workspace Link goes to create group |  |
| click_and_wait | link=Create New Workspace | 30000 |
| text_like | //body | You can create a new Group, or add a workspace to an existing Group. |
| text_like | //body | To add a workspace to an existing group, go to the "Group Directory" |
| text_like | //body | To add a workspace to a new group, go to "Create Group" under the Groups pulldown |
| wait_for_element_visible_ok | link="Group Directory" | 30000 |
| wait_for_element_visible_ok | link="Create Group" | 30000 |
| click_ok | link="Create Group" | 30000 |

| *Comment* | Test Case: User Settings Create Workspace ... and leads into creating a group |  |
| wait_for_text_present_ok | Please choose the group type, then click Next | 30000 |
| wait_for_element_visible_ok | st-create-group-next | 30000 |
| click_and_wait | st-create-group-next |  |
| text_like | //body | Create a Group |

| *Comment* | Test Case: User Settings Create Workspace Remove workspace admin, *do not* see Create New Workspace link |  |
| st-admin | remove-workspace-admin --e %%user%% --w %%ws%% | no longer has the role of 'admin' |
| open_ok | /%%ws%%/ |  |
| wait_for_element_visible_ok | link=Settings | 30000 |
| click_and_wait | link=Settings |  |
| wait_for_element_not_present_ok | link=Create New Workspace | 30000 |

| *Comment* | Test Case: User Settings Create Workspace Promote to account admin, *do* see Create New Workspace link |  |
| st-admin | add-account-admin --e %%user%% --account %%acct%% | now has the role of 'admin' |
| open_ok | /%%ws%%/ |  |
| wait_for_element_visible_ok | link=Settings | 30000 |
| click_and_wait | link=Settings |  |
| wait_for_element_visible_ok | link=Clone This Workspace | 30000 |
| wait_for_element_visible_ok | link=Create New Workspace | 30000 |
| click_and_wait | link=Create New Workspace |  |
| text_like | qr/Workspace Title.+Workspace Name/ism |  |
| location_like | workspaces_create |  |
| click_and_wait | link=Clone This Workspace |  |
| text_like | qr/Clone Workspace.+Workspace Title.+Workspace Name/ism |  |
| location_like | workspace_clone |  |

| *Comment* | Test Case: User Settings Create Workspace Remove account admin, *do not* see Create New Workspace link |  |
| st-admin | remove-account-admin --e %%user%% --account %%acct%% | no longer has the role of 'admin' in the |
| open_ok | /%%ws%%/ |  |
| wait_for_element_visible_ok | link=Settings | 30000 |
| click_and_wait | link=Settings |  |
| wait_for_element_visible_ok | link=My Settings | 5000 |
| wait_for_element_not_present_ok | link=Create New Workspace | 5000 |
| wait_for_element_not_present_ok | link=Clone This Workspace | 5000 |

| *Comment* | Test Case: User Settings Create Workspace TEARDOWN |  |
| st-process-jobs |  |  |
| deactivate-user | %%user%% |  |
| st-admin | delete-workspace --workspace %%ws%% --no-export | has been deleted |
| delete-account | %%acct%% |  |

| *Comment* | Test Case: User Settings Create Workspace COMPLETED |
