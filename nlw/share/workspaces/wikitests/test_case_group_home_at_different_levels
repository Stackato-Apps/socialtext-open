| *Comment* | Test Case: Group Home at Different Levels |  |

* Fixture: SocialWidgets

| *Comment* | Test Case: Group Home at Different Levels Setup |  |  |
| st_setup_a_group | 1 | 1 | 1 |
| set | account_user_best_full | account-user%%start_time%% |  |
| set | account_user | %%account_user_best_full%%@matt.socialtext.net |  |
| set | non_account_user | non-account-user%%start_time%%@matt.socialtext.net |  |
| st-admin | create-user --e %%non_account_user%% --password %%password%% | was created. |  |
| st-admin | create-user --e %%account_user%% --password %%password%% --account %%group_acct%% | was created. |  |
| set | private_grp_id | %%group_id%% |  |
| set | self_join_grp | self-join-grp-%%start_time%% |  |
| create-group | %%self_join_grp%% | %%group_acct%% |  |
| set | self_join_grp_id | %%group_id%% |  |
| st-admin | add-member --e %%username%% --g %%self_join_grp_id%% | is now a member of the |  |
| st-admin | add-group-admin --e %%group_user%% --g %%self_join_grp_id%% | is now a admin of the |  |

| *Comment* | Test Case: Group Home at Different Levels for private group |  |
| st-logoutin | %%group_user%% | %%password%% |
| wait_for_element_present_ok | link=%%group_name%% | 30000 |
| click_and_wait | link=%%group_name%% |  |
| text_like | //body | %%group_name%% |
| wait_for_element_not_present_ok | st-join-group | 30000 |
| st-name-widget | 1 | information_widget |
| st-select-widget-frame | information_widget |  |
| wait_for_text_present_ok | %%group_name%% | 30000 |
| select-frame | relative=parent |  |
| st-name-widget | 2 | workspaces_widget |
| st-name-widget | 3 | signals_widget |
| st-name-widget | 4 | members_widget |
| st-select-widget-frame | workspaces_widget |  |
| wait_for_element_visible_ok | link=%%group_ws%% | 30000 |
| select-frame | relative=parent |  |
| st_verify_text_in_activities_widget | signals_widget | to the group |
| st_verify_text_in_activities_widget | signals_widget | to the workspace |
| st-select-widget-frame | members_widget |  |
| text_like | //body | %%group_user_short%% |
| select-frame | relative=parent |  |

| st-logoutin | %%account_user%% | %%password%% |
| st_open_noeval | /st/group/%%private_grp_id%% |  |
| text_like | //body | The group you are trying to view does not exist. Please check with the group administrator or contact Socialtext Support. |
| text_unlike | //body | %%group_name%% |
| wait_for_element_not_present_ok | st-join-group | 30000 |

| st-logoutin | %%non_account_user%% | %%password%% |
| st_open_noeval | /st/group/%%private_grp_id%% |  |
| text_like | //body | The group you are trying to view does not exist. Please check with the group administrator or contact Socialtext Support. |
| text_unlike | //body | %%group_name%% |
| wait_for_element_not_present_ok | st-join-group | 30000 |

| *Comment* | Group Home at Different Levels Make %%self_join_grp_id%% a self-join group |  |
| st-logoutin |  |  |
| st-admin | add-group-admin --e %%username%% --g %%self_join_grp_id%% | is now a admin |

| open_ok | /st/group/%%self_join_grp_id%% |  |
| st-name-widget | 1 | information_widget |
| st-widget-title-like | information_widget | Information |
| st-select-widget-frame | information_widget |  |
| wait_for_text_present_ok | %%self_join_grp%% | 30000 |
| text_like | //body | (private) |
| text_unlike | //body | (self-join) |
| select-frame | relative=parent |  |

| *Comment* | Group Home at Different Levels do not click Edit, wrong frame level |  |
| open_ok | /st/edit_group/%%self_join_grp_id%% |  |
| st-name-widget | 1 | information_widget |
| st-select-widget-frame | information_widget |  |
| wait_for_element_visible_ok | permission-change | 30000 |
| click_ok | permission-change |  |
| pause | 8000 |  |
| select-frame | relative=parent |  |
| wait_for_element_present_ok | st-create-group-next | 30000 |
| wait_for_element_present_ok | st-lightbox-cancel-create-group | 3000 |
| wait_for_element_present_ok | self-join-radio | 30000 |
| check_ok | self-join-radio |  |
| click_ok | st-create-group-next |  |
| pause | 8000 |  |
| st-name-widget | 1 | information_widget |
| st-select-widget-frame | information_widget |  |
| wait_for_text_present_ok | Group Type | 30000 |
| text_like | //body | qr/self-join.+Change/ism |
| select-frame | relative=parent |  |
| wait_for_element_visible_ok | create-group | 30000 |
| click_ok | create-group |  |

FOR SOME BIZARRE REASON, THIS create-group OPENS A NEW WINDOW.

| *Comment* | Test Case: Group Home at Different Levels See Group is changed to self-join |  |
| wait_for_element_present_ok | link=%%self_join_grp%% | 30000 |
| click_and_wait | link=%%self_join_grp%% |  |
| wait_for_text_present_ok | %%self_join_grp%% | 30000 |

| st-name-widget | 1 | information_widget |
| st-select-widget-frame | information_widget |  |
| wait_for_text_present_ok | %%self_join_grp%% | 10000 |
| text_like | //body | (self-join) |
| select-frame | relative=parent |  |

| *Comment* | Test Case: Group Home at Different Levels for self-join group - as group member |  |
| st-logoutin | %%group_user%% | %%password%% |
| open_ok | /st/group/%%self_join_grp_id%% |  |
| wait_for_text_present_ok | %%self_join_grp%% | 30000 |
| wait_for_element_not_present_ok | st-join-group | 10000 |
| wait_for_element_visible_ok | st-leave-group | 10000 |

| st-name-widget | 2 | workspaces_widget |
| st-name-widget | 3 | signals_widget |
| st-name-widget | 4 | members_widget |

| st_verify_text_in_activities_widget | signals_widget | added %%short_username%% to the group |

| st-select-widget-frame | members_widget |  |
| text_like | //body | %%group_user_short%% |
| select-frame | relative=parent |  |

| *Comment* | Test Case: Group Home at Different Levels self-join group / account member |  |
| st-logoutin | %%account_user%% | %%password%% |

| open_ok | /st/group/%%self_join_grp_id%% |  |
| wait_for_element_visible_ok | //div[@class='groupsTitle'] | 30000 |
| text_like | //div[@class='groupsTitle'] | %%self_join_grp%% |  |
| wait_for_element_visible_ok | st-join-group | 30000 |

| st-name-widget | 1 | information_widget |
| st-select-widget-frame | information_widget |  |
| wait_for_text_present_ok | Administrators | 30000 |
| wait_for_text_present_ok | %%self_join_grp%% | 30000 |
| select-frame | relative=parent |  |

| st-name-widget | 2 | workspaces_widget |
| st-name-widget | 3 | signals_widget |
| st-name-widget | 4 | members_widget |

| st_verify_text_in_activities_widget | signals_widget | added %%short_username%% to the group |

| st-select-widget-frame | members_widget |  |
| text_like | //body | %%group_user_short%% |
| select-frame | relative=parent |  |

| *Comment* | Test Case: Group Home at Different Levels self-join group / different account member |  |
| st-logoutin | %%non_account_user%% | %%password%% |
| st-open-noeval | /st/group/%%self_join_grp_id%% |  |
| wait_for_element_not_present_ok | st-join-group | 30000 |
| text_like | //body | The group you are trying to view does not exist. Please check with the group administrator or contact Socialtext Support. |

| *Comment* | Test Case: Group Home at Different Levels TEARDOWN |  |
| st-process-jobs |  |  |
| st-admin | delete-workspace --w %%group_ws%% --no-export | has been deleted |
| delete-group | %%self_join_grp_id%% |  |
| delete-group | %%private_grp_id%% |  |
| delete-account | %%group_acct%% |  |

| *Comment* | Test Case: Group Home at Different Levels COMPLETED |  |
